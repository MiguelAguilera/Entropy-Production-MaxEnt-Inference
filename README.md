# Inferring Entropy Production in Many-Body Systems Using Nonequilibrium MaxEnt

The repository includes code to generate data and estimate entropy production (EP) for high-dimensional systems. It accompanies the manuscript:

* Miguel Aguilera, Sosuke Ito, and Artemy Kolchinsky, ``Inferring entropy production in many-body systems using nonequilibrium MaxEnt'', 2025.

The code uses `numpy`, `numba`, and `torch` for acceleration.  It takes advantage of GPU if available. 

### Demonstration files

A few simple scripts to get started.

**example_multipartite.py**:  generate data and estimate EP in a multipartite dataset (the nonequilibrium spin model).

**example_nonmultipartite.py**: generate data and estimate EP for a nonmultipartite dataset, as specified by samples of starting and ending states. This dataset is also generated by the nonequilibrium spin model, but converted to nonmultipartite format.

### Other files

**ep_estimators.py**: functions to estimate EP from sampled data. We use PyTorch to accelerate estimation/optimization.

**spin_model.py**: implementation  the nonequilibrium spin model. This includes generation of random coupling matrices, Monte Carlo sampling (`spin_model.run_simulation(...)`), calculation of observables $g_{ij}(\vec{\boldsymbol{x}}) =(x_{i,1}-x_{i,0})x_{j,0}$, and estimation of "ground-truth" EP from empirical statistics. In order to minimize memory/storage, `spin_model.run_simulation` returns samples in a compressed format that exploits the multipartite nature of the dynamics. Specifically, it returns a pair of numpy arrays `S` and `F` where:
* `S` is a 2-dimensional array of type `int8` containing states sampled from the steady-state distribution. 
For a system with `N` spins, `S` has dimensions `[samples_per_spin] x [N]` and its entries are all -1s and 1s.
* `F` is a 2-dimensional array of type `bool` also with dimensions `[samples_per_spin] x [N]`. `F` provides
a compressed representation of `samples_per_spin * N` samples of spin flips. 
Specifically, `F[j,i]=True` if spin `i` flipped in a random sample starting from state `S[j,:]`, 
and `F[j,i]=False` if it did not flip.
The set of states in which spin `i` flipped can be accessed as `S[F[:,i],:]`.

**utils.py**: useful utilities for working with `torch`, solving linear systems, etc.

**tests.py**: contains some unit tests. Can be run with `pytest tests.py` from the root directory.


**results_spinmodel/** and **results_neuropixels/**: directories with additional code for the two examples discussed in the manuscript.
